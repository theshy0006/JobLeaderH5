{"version":3,"sources":["uni-app:///main.js",null,"webpack:////Users/dede/Desktop/STWorker/pages/upload/upload.vue?f2da","webpack:////Users/dede/Desktop/STWorker/pages/upload/upload.vue?a4d9","webpack:////Users/dede/Desktop/STWorker/pages/upload/upload.vue?477d","uni-app:///pages/upload/upload.vue","webpack:////Users/dede/Desktop/STWorker/pages/upload/upload.vue?3c77","webpack:////Users/dede/Desktop/STWorker/pages/upload/upload.vue?052a"],"names":["createPage","Page"],"mappings":"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","file":"pages/upload/upload.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/upload/upload.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./upload.vue?vue&type=template&id=132d2ab4&scoped=true&\"\nvar renderjs\nimport script from \"./upload.vue?vue&type=script&lang=js&\"\nexport * from \"./upload.vue?vue&type=script&lang=js&\"\nimport style0 from \"./upload.vue?vue&type=style&index=0&id=132d2ab4&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"132d2ab4\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/upload/upload.vue\"\nexport default component.exports","export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./upload.vue?vue&type=template&id=132d2ab4&scoped=true&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./upload.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./upload.vue?vue&type=script&lang=js&\"","<template>\n    <view>\n        <cu-custom bgColor=\"bg-gradual-blue\" :isBack=\"true\">\n        \t<block slot=\"backText\">返回</block>\n        \t<block slot=\"content\">\n                <view class=\"topFont\">上报事件</view>\n                </block>\n        </cu-custom>\n        <view class=\"p eventItem bg-white flex flex-direction radius\">\n            <form>\n                <view class=\"cu-form-group\">\n                    <view class=\"title\">所属组织</view>\n                    <input placeholder=\"\" name=\"input\" \n                    v-model=\"deptName\" disabled = 'true' style=\"text-align:right\">\n                    </input>\n                </view>\n                <view class=\"cu-form-group\">\n                    <view class=\"title\">事件类型</view>\n                    <picker @change=\"PickerChange\" :value=\"index\" :range=\"picker\">\n                        <view class=\"picker\">\n                            {{index>-1?picker[index]:'请选择事件类型'}}\n                        </view>\n                    </picker>\n                </view>\n                <view class=\"cu-form-group align-start\" style=\"flex-direction: column; height: 200rpx;\">\n                    <view class=\"title\">事件描述</view>\n                    <textarea maxlength=\"30\" v-model=\"reason\"\n                     placeholder=\"请简单描述事件内容，最多30个字\">\n                    </textarea>\n                </view>\n                <view class=\"cu-form-group\">\n                    <view class=\"title\">位置</view>\n                    <input placeholder=\"请输入事件发生位置\" \n                    name=\"input\" style=\"text-align:right\" v-model=\"location\">\n                    </input>\n                    <text class='cuIcon-locationfill text-orange' @click=\"openMap\"></text>\n                </view>\n            </form>\n            \n            \n        </view>\n        \n        <view style=\"margin-top: 40rpx;\">\n        </view>\n        <view class=\"cu-form-group\" style=\"background-color: unset;\">\n            <view class=\"grid col-4 grid-square flex-sub\">\n                <view class=\"bg-img\" v-for=\"(item,index) in imgList\" :key=\"index\" @tap=\"ViewImage\" :data-url=\"imgList[index]\">\n                 <image :src=\"imgList[index]\" mode=\"aspectFill\"></image>\n                    <view class=\"cu-tag bg-red\" @tap.stop=\"DelImg\" :data-index=\"index\">\n                        <text class='cuIcon-close'></text>\n                    </view>\n                </view>\n                <view class=\"solids bg-white addGroup\" @tap=\"ChooseImage\" v-if=\"imgList.length<3\">\n                    <text class='cuIcon-camera alertNN'></text>\n                    <view class=\"alertPP\">上传照片<br>最多3张</view>\n                </view>\n            </view>\n        </view>\n        <view class=\"padding flex flex-direction\">\n            <button class=\"cu-btn bg-gradual-blue lg shadow round\" @click=\"upload\">确认提交</button>\n        </view>\n    </view>\n</template>\n\n<script>\nimport Vue from 'vue'\n    import {\n    \tmapState\n    } from 'vuex'\n\texport default {\n        computed: mapState(['token', 'id', 'type']),\n        \n\t\tdata() {\n\t\t\treturn {\n\t\t\t\timgList: [],\n                cardNo:\"\",\n                reason:'',\n                driverName:'',\n                loadModal:false,\n                modalName: \"\",\n                urlArray: [],\n                deptName: '',\n                index: -1,\n                picker: ['路面问题', '垃圾桶问题', '其他问题'],\n                deptId: '',\n                location: '',\n                phone:'',\n                longitude:'',\n                latitude:''\n\t\t\t};\n\t\t},\n        onLoad: function (option) {\n            console.log(option.deptName); //打印出上个页面传递的参数。\n            this.deptName = option.deptName;\n            this.deptId = option.deptId;\n            this.phone = option.phone;\n            \n            this.longitude = option.longitude;\n            this.latitude = option.latitude;\n        },\n        methods: {\n            PickerChange(e) {\n            \tthis.index = e.detail.value\n            },\n            \n\t\t\tLoadModal(e) {\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: 'loading'\r\n\t\t\t\t});\n\t\t\t},\n            showModal(e) {\n                this.modalName = \"bottomModal\"  \n            },\n            hideModal(e) {\n            \tthis.modalName = null\n            },\n            ChooseImage() {\n                var that = this\n            \tuni.chooseImage({\n            \t\tcount: 3, //默认9\n            \t\tsizeType: ['compressed'], //可以指定是原图还是压缩图，默认二者都有\n            \t\tsourceType: ['album','camera'], //从相册选择\n            \t\tsuccess: (res) => {\n            \t\t\tif (that.imgList.length != 0) {\n                            if ((that.imgList.length + res.tempFilePaths.length) <= 3) {\n                              that.imgList = that.imgList.concat(res.tempFilePaths)\n                            } else {\n                                uni.showToast({\n                                    title:'最多只能上传3张图片',\n                                    icon:'none'\n                                })\n                            }\n            \t\t\t} else {\n            \t\t\t\tthat.imgList = res.tempFilePaths\n            \t\t\t}\n                        that.urlBase64(res.tempFilePaths)\n            \t\t}\n            \t});\n            },\n            ViewImage(e) {\n            \tuni.previewImage({\n            \t\turls: this.imgList,\n            \t\tcurrent: e.currentTarget.dataset.url\n            \t});\n            },\n            urlBase64(array) {\n                \n                for (var i = 0; i < array.length; i++) { \n                    var toBase64Url;\n                    　　uni.request({\n                    　　　　url: array[i],\n                    　　　　method: 'GET',\n                    　　　　responseType: 'arraybuffer',\n                    　　　　success: async res => {\n                    　　　　　　  let base64 = wx.arrayBufferToBase64(res.data); //把arraybuffer转成base64\n                    　　　　　　  toBase64Url = 'data:image/jpeg;base64,' + base64; //不加上这串字符，在页面无法显示\n                                if (this.urlArray.length < 3) {\n                                    this.urlArray.push(toBase64Url)\n                                }\n                    　　　　 }\n                    　　});\n                }\n                \n\n            },\n            \n            DelImg(e) {\n            \tuni.showModal({\n            \t\tcontent: '确定要删除这张照片吗？',\n            \t\tcancelText: '取消',\n            \t\tconfirmText: '确定',\n            \t\tsuccess: res => {\n            \t\t\tif (res.confirm) {\n            \t\t\t\tthis.imgList.splice(e.currentTarget.dataset.index, 1)\n                            this.urlArray.splice(e.currentTarget.dataset.index, 1)\n            \t\t\t}\n            \t\t}\n            \t})\n            },\n            openMap: function () {\n                // uni.navigateTo({\n                //     url:(\"../map/map?longitude=\"+this.longitude\n                //     + \"&latitude=\"+this.latitude\n                //     )\n                // })\n\n                uni.chooseLocation({\n                    success: (res) => {\n                        // this.hasLocation = true,\n                        //this.location = formatLocation(res.longitude, res.latitude),\n                        this.location = res.address\n                    }\n                }) \n            },\n            upload() {\n                if (this.index == -1 ) {\n                    uni.showToast({\n                        title:\"请选择事件类型\",\n                        icon:'none'\n                    })\n                    return\n                }\n                \n                if (this.reason.length == 0 ) {\n                    uni.showToast({\n                        title:\"请简单描述事件内容\",\n                        icon:'none'\n                    })\n                    return\n                }\n                \n                if (this.imgList.length == 0) {\n                    uni.showToast({\n                        title:\"请上传图片\",\n                        icon:'none'\n                    })\n                    return\n                }\n                var url = [];\n                url = url.concat(this.urlArray)\n                while(url.length < 3) {\n                    url.push('')\n                }\n                this.LoadModal()\n                uni.request({\n                    url: this.GLOBAL.UploadEvent,\n                    dataType: 'jsonp',\n                    method: 'POST',\n                    header: {\n                        access_token:this.token,\n                    },\n                    data: {\n                        access_token:this.token,\n                        eventType: this.index + 1, // 页码\n                        phoneNum:this.phone,\n                        uploadName:this.driverName,\n                        inspectorId:this.id,\n                        deptId:this.deptId,\n                        location:this.location,\n                        eventDescription:this.reason,\n                        image1:url[0],\n                        Image2:url[1],\n                        Image3:url[2]\n                    }\n                }).then(data => {\n                    //data为一个数组，数组第一项为错误信息，第二项为返回数据\n                    uni.hideLoading();\n                    var [error, res]  = data;\n                    console.log(res.data);\n                    let response = JSON.parse(res.data);\n\n                    if ( response.code == 200 ) {\n                        uni.showModal({\n                            title: '提交成功',\n                            showCancel: false,\n                        \tconfirmText: '知道了',\n                        \tsuccess: res => {\n                                uni.navigateBack({\n                                    delta: 3\n                                });\n                        \t}\n                        })\n                    } else {\n                        uni.showToast({\n                        \ttitle:response.message,\n                        \ticon:\"none\"\n                        }) \n                    }\n                }).catch(err => {\n                    uni.hideLoading();\n                \tconsole.log('request fail', err);\n                \tuni.showModal({\n                \t\tcontent: err.errMsg,\n                \t\tshowCancel: false\n                \t});\n                }); \n            }\n        }\n\t}\n</script>\n\n<style scoped>\n    .eventItem {\n        margin: 10rpx;\n    }\n    .title {\n        color: #222222;\n        font-size: 32rpx;\n    }\n    \n    .cu-form-group2 {\n    \tbackground-color: #ffffff;\n    \tpadding: 1upx 30upx;\n    \tdisplay: flex;\n    \talign-items: center;\n    \tmin-height: 100upx;\n    \tjustify-content: space-between;\n    }\n    .addGroup {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n    }\n    .alertNN {\n        padding-bottom: 40rpx;\n    }\n    .alertPP {\n        margin-top: 90rpx;\n        line-height:1.1;\n        font-size: 24rpx;\n        color: #666666;\n        text-align: center;\n    }\n    \n</style>\n","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./upload.vue?vue&type=style&index=0&id=132d2ab4&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./upload.vue?vue&type=style&index=0&id=132d2ab4&scoped=true&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1605864115019\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}